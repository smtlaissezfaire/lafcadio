#!/usr/bin/env ruby

require 'ubygems'
require 'lafcadio/depend'
require 'lafcadio/schema'
require 'lafcadio/util'
require 'getoptlong'
include Lafcadio

opts = GetoptLong.new(
	[ '--config', '-c', GetoptLong::REQUIRED_ARGUMENT ],
	[ '--class',  '-C', GetoptLong::OPTIONAL_ARGUMENT ]
)
if ( ( optArray = opts.get ) && ARGV.size >= 1 )
	configFile = optArray[1]
	LafcadioConfig.set_filename( configFile )
	class_opts = opts.get
	ARGV.each { |fileName|
		require "#{ fileName }"
		if class_opts
			className = class_opts.last
		else
			fileName =~ /(\w*)\.rb/
			className = $1
		end
		domainClass = Class.get_class( className )
		if domainClass
			statement = CreateTableStatement.new( domainClass )
			puts statement.to_sql
		else
			puts "No domain class in #{ fileName }"
		end
	}
else
	puts "lafcadio_schema -c config domain1.rb {, domain2.rb, domain3.rb ... }"
end